import t from"/@npm/string-width";import e from"/@npm/strip-ansi";import n from"/@npm/ansi-styles";const o=new Set(["","Â›"]),wrapAnsi=t=>`${o.values().next().value}[${t}m`,wrapAnsiHyperlink=t=>`${o.values().next().value}]8;;${t}`,wrapWord=(n,r,i)=>{const s=[...r];let l=!1,p=!1,h=t(e(n[n.length-1]));for(const[e,m]of s.entries()){const r=t(m);h+r<=i?n[n.length-1]+=m:(n.push(m),h=0),o.has(m)&&(l=!0,p=s.slice(e+1).join("").startsWith("]8;;")),l?p?""===m&&(l=!1,p=!1):"m"===m&&(l=!1):(h+=r,h===i&&e<s.length-1&&(n.push(""),h=0))}!h&&n[n.length-1].length>0&&n.length>1&&(n[n.length-2]+=n.pop())},stringVisibleTrimSpacesRight=e=>{const n=e.split(" ");let o=n.length;for(;o>0&&!(t(n[o-1])>0);)o--;return o===n.length?e:n.slice(0,o).join(" ")+n.slice(o).join("")},exec=(e,r,i={})=>{if(!1!==i.trim&&""===e.trim())return"";let s,l,p="";const h=(e=>e.split(" ").map(e=>t(e)))(e);let m=[""];for(const[n,o]of e.split(" ").entries()){!1!==i.trim&&(m[m.length-1]=m[m.length-1].trimStart());let e=t(m[m.length-1]);if(0!==n&&(e>=r&&(!1===i.wordWrap||!1===i.trim)&&(m.push(""),e=0),(e>0||!1===i.trim)&&(m[m.length-1]+=" ",e++)),i.hard&&h[n]>r){const t=r-e,i=1+Math.floor((h[n]-t-1)/r);Math.floor((h[n]-1)/r)<i&&m.push(""),wrapWord(m,o,r)}else{if(e+h[n]>r&&e>0&&h[n]>0){if(!1===i.wordWrap&&e<r){wrapWord(m,o,r);continue}m.push("")}e+h[n]>r&&!1===i.wordWrap?wrapWord(m,o,r):m[m.length-1]+=o}}!1!==i.trim&&(m=m.map(stringVisibleTrimSpacesRight));const a=[...m.join("\n")];for(const[t,c]of a.entries()){if(p+=c,o.has(c)){const{groups:e}=new RegExp("(?:\\[(?<code>\\d+)m|\\]8;;(?<uri>.*))").exec(a.slice(t).join(""))||{groups:{}};if(void 0!==e.code){const t=Number.parseFloat(e.code);s=39===t?void 0:t}else void 0!==e.uri&&(l=0===e.uri.length?void 0:e.uri)}const e=n.codes.get(Number(s));"\n"===a[t+1]?(l&&(p+=wrapAnsiHyperlink("")),s&&e&&(p+=wrapAnsi(e))):"\n"===c&&(s&&e&&(p+=wrapAnsi(s)),l&&(p+=wrapAnsiHyperlink(l)))}return p};export default(t,e,n)=>String(t).normalize().replace(/\r\n/g,"\n").split("\n").map(t=>exec(t,e,n)).join("\n");